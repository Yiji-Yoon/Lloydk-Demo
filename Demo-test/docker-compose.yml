services:
  qdrant:
    image: qdrant/qdrant
    container_name: qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - jolly_neumann:/qdrant/storage

  frontend:
    image: demo-frontend
    container_name: demo-frontend-dev
    build: ./frontend
    ports:
      - "5173:5173"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0"

  backend:
    image: demo-backend
    container_name: demo-backend-dev
    build: ./backend
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - OLLAMA_HOST=http://host.docker.internal:11434
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - qdrant
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
      - hf_cache:/root/.cache/huggingface
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload
    env_file:
      - ./backend/.env

# [ìˆ˜ì • í¬ì¸íŠ¸] ë³¼ë¥¨ë“¤ì„ ê°ê° ë…ë¦½ì ìœ¼ë¡œ ì„ ì–¸í•´ì•¼ í•©ë‹ˆë‹¤.
volumes:
  jolly_neumann:
    external: true
  hf_cache:    # ğŸ‘ˆ jolly_neumannê³¼ ê°™ì€ ë¼ì¸ì— ë§ì¶°ì•¼ í•©ë‹ˆë‹¤!

# docker compose up --build